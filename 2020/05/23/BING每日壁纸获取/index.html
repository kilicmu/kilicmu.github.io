<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="kilic">
  <!-- Open Graph Data -->
  <meta property="og:title" content="Bing每日壁纸获取"/>
  <meta property="og:description" content="咸鱼，无业游民" />
  <meta property="og:site_name" content="kilic の 部落格"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://kilic.site"/>
  
    <link rel="alternate" href="/atom.xml" title="kilic の 部落格" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>kilic の 部落格</title>

  <!-- Bootstrap CSS -->
  
<link rel="stylesheet" href="/css/bootstrap.min.css">

  <!-- Custom CSS -->
  
  
<link rel="stylesheet" href="/css/style.dark.css">


  <!-- Google Analytics -->
  

<meta name="generator" content="Hexo 4.2.0"></head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/m2.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">Bing每日壁纸获取</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/kilicmu">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:kilicmu3389@outlook.com">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By kilic</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2020-05-23</span>
            <span class="time">03:03:28</span>
          </span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/NODEJS/">#nodejs</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <p>每天使用Bing的时候都会看到他给你应用更换一个新的壁纸，我们今天就要获取这个每日壁纸，可以用它来做一个每日动态的图片更新接口。</p>
<a id="more"></a>

<h2 id="技术选择"><a href="#技术选择" class="headerlink" title="技术选择"></a>技术选择</h2><p>本次将使用nodejs来写这个脚本。</p>
<p>因为本人对nodejs的一些api不是很了解，所以这次选择了nodejs，算是借着这次机会看去读文档了。</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>通过使用firefox自带的网络分析工具，分析bing页面的所有请求，可以发现有这么个请求，服务端响应了一个json，看样子是我们的目标了：</p>
<p><img src="https://i.niupic.com/images/2020/05/23/7Vdz.png" alt="分析"></p>
<p>那么我们分析一下这个url：<a href="https://cn.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1&amp;nc=1590246875423&amp;pid=hp&amp;mkt=zh-CN。">https://cn.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1&amp;nc=1590246875423&amp;pid=hp&amp;mkt=zh-CN。</a></p>
<p>其中idx是啥不知道（后来发现好像是以前推荐的图片），nc看格式是时间戳，pid和mkt应该是不用管的。</p>
<p>那么先我们的思路就很简单了，手动拼装这个url然后请求获取url再一次请求然后存储获取的字节就ok了。同时我们需要存储图片列表和存储日志。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>先做日志处理。</p>
<h3 id="日志处理"><a href="#日志处理" class="headerlink" title="日志处理"></a>日志处理</h3><p><code>touch log.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Log</span> <span class="keyword">extends</span> <span class="title">EventEmitter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.filename = <span class="string">"require-msg.log"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  toAlignment (value) &#123;</span><br><span class="line">    value = value.toString();</span><br><span class="line">    <span class="keyword">if</span> (value.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">      value = <span class="string">'0'</span> + value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getFormatTime (date) &#123;</span><br><span class="line">    <span class="keyword">const</span> month = <span class="keyword">this</span>.toAlignment(date.getMonth() + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> day = <span class="keyword">this</span>.toAlignment(date.getDate());</span><br><span class="line">    <span class="keyword">const</span> hours = <span class="keyword">this</span>.toAlignment(date.getHours());</span><br><span class="line">    <span class="keyword">const</span> minutes = <span class="keyword">this</span>.toAlignment(date.getMinutes());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`[<span class="subst">$&#123;month&#125;</span>-<span class="subst">$&#123;day&#125;</span> <span class="subst">$&#123;hours&#125;</span>:<span class="subst">$&#123;minutes&#125;</span>] `</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> log (msg) &#123;</span><br><span class="line">    <span class="keyword">const</span> currentTime = <span class="keyword">this</span>.getFormatTime(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">    <span class="keyword">const</span> logMsg = <span class="string">`<span class="subst">$&#123;currentTime&#125;</span> <span class="subst">$&#123;msg&#125;</span>\n`</span>;</span><br><span class="line">    <span class="keyword">const</span> fd = <span class="keyword">await</span> fs.openSync(<span class="keyword">this</span>.filename, <span class="string">'a'</span>);</span><br><span class="line">    fs.writeSync(fd, logMsg);</span><br><span class="line">    fs.closeSync(fd);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Log;</span><br></pre></td></tr></table></figure>

<p>以这种格式输出日志：</p>
<p><img src="https://i.niupic.com/images/2020/05/23/7Vgp.png" alt="log demo"></p>
<p>考虑到文件路径问题以及文件扩展名无法直接获取，我们需要几个工具函数：</p>
<p><code>touch utils.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检查路径是否存在 如果不存在则创建路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>folderpath 文件路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">checkDirExist = <span class="function">(<span class="params">folderpath</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> pathArr = folderpath.split(<span class="string">'/'</span>)</span><br><span class="line">  <span class="keyword">let</span> _path = <span class="string">''</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; pathArr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (pathArr[i]) &#123;</span><br><span class="line">      _path += <span class="string">`/<span class="subst">$&#123;pathArr[i]&#125;</span>`</span></span><br><span class="line">      <span class="keyword">if</span> (!fs.existsSync(_path)) &#123;</span><br><span class="line">        fs.mkdirSync(_path)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  从uri获取扩展名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">_path</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;string&#125;</span> </span>扩展名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> getExt = <span class="function">(<span class="params">_path</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reg = <span class="regexp">/\?id=.*(\..*)&amp;/</span> <span class="comment">//获取扩展名的正则</span></span><br><span class="line">  _path.match(reg)</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">RegExp</span>.$<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123; checkDirExist, getExt &#125;</span><br></pre></td></tr></table></figure>

<p>然后开始主要逻辑的编写。</p>
<h3 id="正戏"><a href="#正戏" class="headerlink" title="正戏"></a>正戏</h3><p><code>touch index.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>)</span><br><span class="line"><span class="keyword">const</span> Log = <span class="built_in">require</span>(<span class="string">'./log.js'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; URL &#125; = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; checkDirExist, getExt &#125; = <span class="built_in">require</span>(<span class="string">'./utils.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> l = <span class="keyword">new</span> Log()</span><br><span class="line"><span class="keyword">const</span> pictureList = path.resolve(__dirname, <span class="string">'./picturelist.json'</span>)</span><br><span class="line"><span class="keyword">const</span> baseURL = <span class="string">'https://cn.bing.com/'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从bing获取图片保存到目标目录</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>downloadPath 图片下载位置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>currentNo 图片获取编号[0,1,2....]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> savePicture = <span class="function">(<span class="params">downloadPath = <span class="string">'images'</span>, currentNo = <span class="number">0</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> timeStemp = <span class="built_in">Date</span>.now()</span><br><span class="line">  <span class="keyword">const</span> JSONResourceURI = <span class="string">`/HPImageArchive.aspx?format=js&amp;idx=<span class="subst">$&#123;currentNo&#125;</span>&amp;n=1&amp;nc=<span class="subst">$&#123;timeStemp&#125;</span>&amp;pid=hp`</span></span><br><span class="line">  <span class="keyword">const</span> firstReqURL = <span class="keyword">new</span> URL(JSONResourceURI, baseURL).href</span><br><span class="line">  downloadPath = path.resolve(__dirname, downloadPath)</span><br><span class="line"></span><br><span class="line">  checkDirExist(downloadPath)</span><br><span class="line"></span><br><span class="line">  https.get(firstReqURL, (res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> _firstJSONChunks = []</span><br><span class="line"></span><br><span class="line">    res.on(<span class="string">'data'</span>, (data) =&gt; &#123;</span><br><span class="line">      _firstJSONChunks.push(data)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    res.on(<span class="string">'error'</span>, (error) =&gt; &#123;</span><br><span class="line">      l.log(error.toString())</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    res.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> resJSON = <span class="built_in">JSON</span>.parse(Buffer.concat(_firstJSONChunks))</span><br><span class="line">      <span class="keyword">const</span> resourceURI = resJSON.images[<span class="number">0</span>].url</span><br><span class="line">      <span class="keyword">const</span> secondReqURL = <span class="keyword">new</span> URL(resourceURI, baseURL).href</span><br><span class="line">      <span class="keyword">const</span> ext = getExt(secondReqURL)</span><br><span class="line">      <span class="keyword">const</span> resourceName = (resJSON.images[<span class="number">0</span>].copyright + ext).replace(</span><br><span class="line">        /\s|\<span class="comment">/*/g,</span></span><br><span class="line"><span class="comment">        ''</span></span><br><span class="line"><span class="comment">      )</span></span><br><span class="line"><span class="comment">      const resourcePath = path.resolve(downloadPath, resourceName)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      https.get(secondReqURL, (res) =&gt; &#123;</span></span><br><span class="line"><span class="comment">        const _secondDataChunks = []</span></span><br><span class="line"><span class="comment">        res.on('data', async (data) =&gt; &#123;</span></span><br><span class="line"><span class="comment">          _secondDataChunks.push(data)</span></span><br><span class="line"><span class="comment">        &#125;)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        res.on('end', async () =&gt; &#123;</span></span><br><span class="line"><span class="comment">          const imgBuffer = Buffer.concat(_secondDataChunks)</span></span><br><span class="line"><span class="comment">          const absDir = path.resolve(downloadPath, resourceName)</span></span><br><span class="line"><span class="comment">          const fd = await fs.openSync(resourcePath, 'w')</span></span><br><span class="line"><span class="comment">          fs.writeSync(fd, imgBuffer)</span></span><br><span class="line"><span class="comment">          fs.closeSync(fd)</span></span><br><span class="line"><span class="comment">          let list</span></span><br><span class="line"><span class="comment">          try &#123;</span></span><br><span class="line"><span class="comment">            list = require(pictureList)</span></span><br><span class="line"><span class="comment">          &#125; catch (_) &#123;</span></span><br><span class="line"><span class="comment">            l.log(`error: no file, created $&#123;pictureList&#125;`)</span></span><br><span class="line"><span class="comment">            fs.writeFileSync(pictureList, JSON.stringify([]))</span></span><br><span class="line"><span class="comment">            list = require(pictureList)</span></span><br><span class="line"><span class="comment">          &#125;</span></span><br><span class="line"><span class="comment">          list.push(absDir)</span></span><br><span class="line"><span class="comment">          list = Array.from(new Set(list))</span></span><br><span class="line"><span class="comment">          l.log(`writed $&#123;resourceName&#125; to $&#123;absDir&#125;`)</span></span><br><span class="line"><span class="comment">          fs.writeFileSync(pictureList, JSON.stringify(list))</span></span><br><span class="line"><span class="comment">        &#125;)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        res.on('error', () =&gt; &#123;</span></span><br><span class="line"><span class="comment">          l.log(error.toString())</span></span><br><span class="line"><span class="comment">        &#125;)</span></span><br><span class="line"><span class="comment">      &#125;)</span></span><br><span class="line"><span class="comment">    &#125;)</span></span><br><span class="line"><span class="comment">  &#125;)</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这里主要的逻辑就是两层http get请求，第一次获取图片的JSON信息，然后利用这个JSON信息获取图片二进制数据。这里要注意，有时候图片很大，我们需要多次的chunk整合然后存储。</p>
<p>可以再添加一个方法，用来获取所有的图片地址：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;array&#125;</span> </span>获取目前已经保存的图片列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> getEexistPictureList = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> res = [];</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    res = <span class="built_in">require</span>(path.resolve(__dirname, pictureList))</span><br><span class="line">    </span><br><span class="line">  &#125;<span class="keyword">catch</span>(_)&#123;</span><br><span class="line">    l.log(<span class="string">`error: no file, created <span class="subst">$&#123;pictureList&#125;</span>`</span>)</span><br><span class="line">    fs.writeFileSync(pictureList, <span class="built_in">JSON</span>.stringify([])) </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样其实就可以用了，我们接下来看一看服务器的部署。</p>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>我们可以编写一个调用脚本，比如说：</p>
<p><code>touch demo.js</code></p>
<p>简单调用一下我们的函数：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const &#123; savePicture &#125; = <span class="built_in">require</span>(<span class="string">'bingSpider'</span>)</span><br><span class="line">const <span class="built_in">path</span> = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line">const <span class="built_in">abs</span> = <span class="built_in">path</span>.resolve(__dirname, <span class="string">'images'</span>)</span><br><span class="line">savePicture(<span class="built_in">abs</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>然后我们可以有很多方式让这个脚本定时执行，纯前端一下的话可以改动这个脚本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; savePicture &#125; = <span class="built_in">require</span>(<span class="string">'bingSpider'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> abs = path.resolve(__dirname, <span class="string">'images'</span>)</span><br><span class="line"></span><br><span class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  savePicture(abs, <span class="number">1</span>)</span><br><span class="line">&#125;, <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>)</span><br></pre></td></tr></table></figure>

<p>然后用pm2让他在后台跑就好。</p>
<p>如果懂一些linux运维，可以使用cron</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vim</span> <span class="string">/etc/crontab</span></span><br><span class="line"><span class="comment"># 根据已有格式添加</span></span><br><span class="line"><span class="attr">0</span> <span class="string">0 * * * node 文件路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看是否开机自启</span></span><br><span class="line"><span class="attr">chkconfig</span> <span class="string">--list crond </span></span><br><span class="line"><span class="comment"># 自启</span></span><br><span class="line"><span class="attr">chkconfig</span> <span class="string">crond on</span></span><br></pre></td></tr></table></figure>

<p>如果有问题，不知道的可以自己去google。</p>
<p>以上。</p>

        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->

<script src="/js/highlight.pack.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

