

<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Bing每日壁纸获取 - herin の 部落格</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />

  
  <meta name="keywords" content="undefined"> 
  
  <meta name="description" content="每天使用 Bing 的时候都会看到他给你应用更换一个新..."> 
  
  <meta name="author" content="herin"> 

  
    <link rel="icon" href="/images/icons/favicon-16x16.png" type="image/png" sizes="16x16">
  
  
    <link rel="icon" href="/images/icons/favicon-32x32.png" type="image/png" sizes="32x32">
  
  
    <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png" sizes="180x180">
  
  
    <meta rel="mask-icon" href="/images/icons/stun-logo.svg" color="#333333">
  
  
    <meta rel="msapplication-TileImage" content="/images/icons/favicon-144x144.png">
    <meta rel="msapplication-TileColor" content="#000000">
  

  
<link rel="stylesheet" href="/css/style.css">


  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1445822_h1619vhl1nr.css">

  

  
  
  
<link rel="stylesheet" href="https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.css">

  

  
  
  
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/xcode.min.css">

  

  <script>
    var CONFIG = window.CONFIG || {};
    var ZHAOO = window.ZHAOO || {};
    CONFIG = {
      isHome: false,
      fancybox: true,
      pjax: false,
      lazyload: {
        enable: true,
        loadingImage: '',
      },
      donate: {
        enable: true,
        alipay: '/images/others/alipay.jpg',
        wechat: '/images/others/wechat.jpg'
      },
      motto: {
        api: '',
        default: 'fading is true while flowering is past。'
      },
      galleries: {
        enable: true
      },
      fab: {
        enable: true,
        alwaysShow: false
      },
      carrier: {
        enable: true
      },
      daovoice: {
        enable: true
      }
    }
  </script>

  

  
<meta name="generator" content="Hexo 5.3.0"></head>
<body class="lock-screen">
  <div class="loading"></div>
  


<nav class="navbar">
  <div class="left"></div>
  <div class="center">Bing每日壁纸获取</div>
  <div class="right">
    <i class="iconfont iconmenu j-navbar-menu"></i>
  </div>
</nav>

  <nav class="menu">
  <div class="menu-wrap">
    <div class="menu-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <ul class="menu-content">
      
      
      
      
      <li class="menu-item"><a href="/ " class="underline"> 首页</a></li>
      
      
      
      
      <li class="menu-item"><a href="/galleries " class="underline"> 摄影</a></li>
      
      
      
      
      <li class="menu-item"><a href="/archives " class="underline"> 归档</a></li>
      
      
      
      
      <li class="menu-item"><a href="/tags " class="underline"> 标签</a></li>
      
      
      
      
      <li class="menu-item"><a href="/categories " class="underline"> 分类</a></li>
      
      
      
      
      <li class="menu-item"><a href="/about " class="underline"> 关于</a></li>
      
    </ul>
    <div class="menu-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p></div>
  </div>
</nav>
  <main id="main">
  <div class="container" id="container">
    <article class="article">
  <div class="wrap">
    <section class="head">
  <img   class="lazyload" data-original="https://i.niupic.com/images/2020/10/18/8T2t.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  draggable="false">
  <div class="head-mask">
    <h1 class="head-title">Bing每日壁纸获取</h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>May 23, 2020</span
        class="post-info-item">
      
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>6359</span>
    </div>
  </div>
</section>
    <section class="main">
      <section class="content">
        <h2 id="技术选择"><a href="#技术选择" class="headerlink" title="技术选择"></a>技术选择</h2><p>本次将使用 nodejs 来写这个脚本。</p>
<p>因为本人对 nodejs 的一些 api 不是很了解，所以这次选择了 nodejs，算是借着这次机会看去读文档了。</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>通过使用 firefox 自带的网络分析工具，分析 bing 页面的所有请求，可以发现有这么个请求，服务端响应了一个 json，看样子是我们的目标了：</p>
<p><img   class="lazyload" data-original="https://i.niupic.com/images/2020/05/23/7Vdz.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  alt="分析"></p>
<p>那么我们分析一下这个 url：<a href="https://cn.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1&amp;nc=1590246875423&amp;pid=hp&amp;mkt=zh-CN。">https://cn.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1&amp;nc=1590246875423&amp;pid=hp&amp;mkt=zh-CN。</a></p>
<p>其中 idx 是啥不知道（后来发现好像是以前推荐的图片），nc 看格式是时间戳，pid 和 mkt 应该是不用管的。</p>
<p>那么先我们的思路就很简单了，手动拼装这个 url 然后请求获取 url 再一次请求然后存储获取的字节就 ok 了。同时我们需要存储图片列表和存储日志。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>先做日志处理。</p>
<h3 id="日志处理"><a href="#日志处理" class="headerlink" title="日志处理"></a>日志处理</h3><p><code>touch log.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> EventEmitter = <span class="hljs-built_in">require</span>(<span class="hljs-string">"events"</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Log</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">EventEmitter</span> </span>&#123;<br>  <span class="hljs-keyword">constructor</span>() &#123;<br>    <span class="hljs-keyword">super</span>();<br>    <span class="hljs-keyword">this</span>.filename = <span class="hljs-string">"require-msg.log"</span>;<br>  &#125;<br><br>  toAlignment(value) &#123;<br>    value = value.toString();<br>    <span class="hljs-keyword">if</span> (value.length &lt; <span class="hljs-number">2</span>) &#123;<br>      value = <span class="hljs-string">"0"</span> + value;<br>    &#125;<br>    <span class="hljs-keyword">return</span> value;<br>  &#125;<br><br>  getFormatTime(date) &#123;<br>    <span class="hljs-keyword">const</span> month = <span class="hljs-keyword">this</span>.toAlignment(date.getMonth() + <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">const</span> day = <span class="hljs-keyword">this</span>.toAlignment(date.getDate());<br>    <span class="hljs-keyword">const</span> hours = <span class="hljs-keyword">this</span>.toAlignment(date.getHours());<br>    <span class="hljs-keyword">const</span> minutes = <span class="hljs-keyword">this</span>.toAlignment(date.getMinutes());<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`[<span class="hljs-subst">$&#123;month&#125;</span>-<span class="hljs-subst">$&#123;day&#125;</span> <span class="hljs-subst">$&#123;hours&#125;</span>:<span class="hljs-subst">$&#123;minutes&#125;</span>] `</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">async</span> log(msg) &#123;<br>    <span class="hljs-keyword">const</span> currentTime = <span class="hljs-keyword">this</span>.getFormatTime(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());<br>    <span class="hljs-keyword">const</span> logMsg = <span class="hljs-string">`<span class="hljs-subst">$&#123;currentTime&#125;</span> <span class="hljs-subst">$&#123;msg&#125;</span>\n`</span>;<br>    <span class="hljs-keyword">const</span> fd = <span class="hljs-keyword">await</span> fs.openSync(<span class="hljs-keyword">this</span>.filename, <span class="hljs-string">"a"</span>);<br>    fs.writeSync(fd, logMsg);<br>    fs.closeSync(fd);<br>  &#125;<br>&#125;<br><br><span class="hljs-built_in">module</span>.exports = Log;<br></code></pre></td></tr></table></figure>

<p>以这种格式输出日志：</p>
<p><img   class="lazyload" data-original="https://i.niupic.com/images/2020/05/23/7Vgp.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  alt="log demo"></p>
<p>考虑到文件路径问题以及文件扩展名无法直接获取，我们需要几个工具函数：</p>
<p><code>touch utils.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 检查路径是否存在 如果不存在则创建路径</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param <span class="hljs-type">&#123;string&#125;</span> </span>folderpath 文件路径</span><br><span class="hljs-comment"> */</span><br>checkDirExist = <span class="hljs-function">(<span class="hljs-params">folderpath</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> pathArr = folderpath.split(<span class="hljs-string">"/"</span>);<br>  <span class="hljs-keyword">let</span> _path = <span class="hljs-string">""</span>;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; pathArr.length; i++) &#123;<br>    <span class="hljs-keyword">if</span> (pathArr[i]) &#123;<br>      _path += <span class="hljs-string">`/<span class="hljs-subst">$&#123;pathArr[i]&#125;</span>`</span>;<br>      <span class="hljs-keyword">if</span> (!fs.existsSync(_path)) &#123;<br>        fs.mkdirSync(_path);<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  从uri获取扩展名</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param <span class="hljs-type">&#123;string&#125;</span> <span class="hljs-variable">_path</span></span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return <span class="hljs-type">&#123;string&#125;</span> </span>扩展名</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> getExt = <span class="hljs-function">(<span class="hljs-params">_path</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> reg = <span class="hljs-regexp">/\?id=.*(\..*)&amp;/</span>; <span class="hljs-comment">//获取扩展名的正则</span><br>  _path.match(reg);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">RegExp</span>.$<span class="hljs-number">1</span>;<br>&#125;;<br><span class="hljs-built_in">module</span>.exports = &#123; checkDirExist, getExt &#125;;<br></code></pre></td></tr></table></figure>

<p>然后开始主要逻辑的编写。</p>
<h3 id="正戏"><a href="#正戏" class="headerlink" title="正戏"></a>正戏</h3><p><code>touch index.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> https = <span class="hljs-built_in">require</span>(<span class="hljs-string">"https"</span>);<br><span class="hljs-keyword">const</span> Log = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./log.js"</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);<br><span class="hljs-keyword">const</span> &#123; URL &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">"url"</span>);<br><span class="hljs-keyword">const</span> &#123; checkDirExist, getExt &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./utils.js"</span>);<br><br><span class="hljs-keyword">const</span> l = <span class="hljs-keyword">new</span> Log();<br><span class="hljs-keyword">const</span> pictureList = path.resolve(__dirname, <span class="hljs-string">"./picturelist.json"</span>);<br><span class="hljs-keyword">const</span> baseURL = <span class="hljs-string">"https://cn.bing.com/"</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 从bing获取图片保存到目标目录</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param <span class="hljs-type">&#123;*&#125;</span> </span>downloadPath 图片下载位置</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param <span class="hljs-type">&#123;*&#125;</span> </span>currentNo 图片获取编号[0,1,2....]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> savePicture = <span class="hljs-function">(<span class="hljs-params">downloadPath = <span class="hljs-string">"images"</span>, currentNo = <span class="hljs-number">0</span></span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> timeStemp = <span class="hljs-built_in">Date</span>.now();<br>  <span class="hljs-keyword">const</span> JSONResourceURI = <span class="hljs-string">`/HPImageArchive.aspx?format=js&amp;idx=<span class="hljs-subst">$&#123;currentNo&#125;</span>&amp;n=1&amp;nc=<span class="hljs-subst">$&#123;timeStemp&#125;</span>&amp;pid=hp`</span>;<br>  <span class="hljs-keyword">const</span> firstReqURL = <span class="hljs-keyword">new</span> URL(JSONResourceURI, baseURL).href;<br>  downloadPath = path.resolve(__dirname, downloadPath);<br><br>  checkDirExist(downloadPath);<br><br>  https.get(firstReqURL, (res) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> _firstJSONChunks = [];<br><br>    res.on(<span class="hljs-string">"data"</span>, (data) =&gt; &#123;<br>      _firstJSONChunks.push(data);<br>    &#125;);<br><br>    res.on(<span class="hljs-string">"error"</span>, (error) =&gt; &#123;<br>      l.log(error.toString());<br>    &#125;);<br><br>    res.on(<span class="hljs-string">"end"</span>, () =&gt; &#123;<br>      <span class="hljs-keyword">const</span> resJSON = <span class="hljs-built_in">JSON</span>.parse(Buffer.concat(_firstJSONChunks));<br>      <span class="hljs-keyword">const</span> resourceURI = resJSON.images[<span class="hljs-number">0</span>].url;<br>      <span class="hljs-keyword">const</span> secondReqURL = <span class="hljs-keyword">new</span> URL(resourceURI, baseURL).href;<br>      <span class="hljs-keyword">const</span> ext = getExt(secondReqURL);<br>      <span class="hljs-keyword">const</span> resourceName = (resJSON.images[<span class="hljs-number">0</span>].copyright + ext).replace(<br>        /\s|\<span class="hljs-comment">/*/g,</span><br><span class="hljs-comment">        ""</span><br><span class="hljs-comment">      );</span><br><span class="hljs-comment">      const resourcePath = path.resolve(downloadPath, resourceName);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">      https.get(secondReqURL, (res) =&gt; &#123;</span><br><span class="hljs-comment">        const _secondDataChunks = [];</span><br><span class="hljs-comment">        res.on("data", async (data) =&gt; &#123;</span><br><span class="hljs-comment">          _secondDataChunks.push(data);</span><br><span class="hljs-comment">        &#125;);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        res.on("end", async () =&gt; &#123;</span><br><span class="hljs-comment">          const imgBuffer = Buffer.concat(_secondDataChunks);</span><br><span class="hljs-comment">          const absDir = path.resolve(downloadPath, resourceName);</span><br><span class="hljs-comment">          const fd = await fs.openSync(resourcePath, "w");</span><br><span class="hljs-comment">          fs.writeSync(fd, imgBuffer);</span><br><span class="hljs-comment">          fs.closeSync(fd);</span><br><span class="hljs-comment">          let list;</span><br><span class="hljs-comment">          try &#123;</span><br><span class="hljs-comment">            list = require(pictureList);</span><br><span class="hljs-comment">          &#125; catch (_) &#123;</span><br><span class="hljs-comment">            l.log(`error: no file, created $&#123;pictureList&#125;`);</span><br><span class="hljs-comment">            fs.writeFileSync(pictureList, JSON.stringify([]));</span><br><span class="hljs-comment">            list = require(pictureList);</span><br><span class="hljs-comment">          &#125;</span><br><span class="hljs-comment">          list.push(absDir);</span><br><span class="hljs-comment">          list = Array.from(new Set(list));</span><br><span class="hljs-comment">          l.log(`writed $&#123;resourceName&#125; to $&#123;absDir&#125;`);</span><br><span class="hljs-comment">          fs.writeFileSync(pictureList, JSON.stringify(list));</span><br><span class="hljs-comment">        &#125;);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        res.on("error", () =&gt; &#123;</span><br><span class="hljs-comment">          l.log(error.toString());</span><br><span class="hljs-comment">        &#125;);</span><br><span class="hljs-comment">      &#125;);</span><br><span class="hljs-comment">    &#125;);</span><br><span class="hljs-comment">  &#125;);</span><br><span class="hljs-comment">&#125;;</span><br></code></pre></td></tr></table></figure>

<p>这里主要的逻辑就是两层 http get 请求，第一次获取图片的 JSON 信息，然后利用这个 JSON 信息获取图片二进制数据。这里要注意，有时候图片很大，我们需要多次的 chunk 整合然后存储。</p>
<p>可以再添加一个方法，用来获取所有的图片地址：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return <span class="hljs-type">&#123;array&#125;</span> </span>获取目前已经保存的图片列表</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> getEexistPictureList = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">let</span> res = [];<br>  <span class="hljs-keyword">try</span> &#123;<br>    res = <span class="hljs-built_in">require</span>(path.resolve(__dirname, pictureList));<br>  &#125; <span class="hljs-keyword">catch</span> (_) &#123;<br>    l.log(<span class="hljs-string">`error: no file, created <span class="hljs-subst">$&#123;pictureList&#125;</span>`</span>);<br>    fs.writeFileSync(pictureList, <span class="hljs-built_in">JSON</span>.stringify([]));<br>  &#125;<br>  <span class="hljs-keyword">return</span> res;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>这样其实就可以用了，我们接下来看一看服务器的部署。</p>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>我们可以编写一个调用脚本，比如说：</p>
<p><code>touch demo.js</code></p>
<p>简单调用一下我们的函数：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lua">const &#123; savePicture &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bingSpider'</span>)<br>const <span class="hljs-built_in">path</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)<br>const <span class="hljs-built_in">abs</span> = <span class="hljs-built_in">path</span>.resolve(__dirname, <span class="hljs-string">'images'</span>)<br>savePicture(<span class="hljs-built_in">abs</span>, <span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>

<p>然后我们可以有很多方式让这个脚本定时执行，纯前端一下的话可以改动这个脚本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> &#123; savePicture &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">"bingSpider"</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);<br><span class="hljs-keyword">const</span> abs = path.resolve(__dirname, <span class="hljs-string">"images"</span>);<br><br>setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  savePicture(abs, <span class="hljs-number">1</span>);<br>&#125;, <span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span>);<br></code></pre></td></tr></table></figure>

<p>然后用 pm2 让他在后台跑就好。</p>
<p>如果懂一些 linux 运维，可以使用 cron</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">vim</span> <span class="hljs-string">/etc/crontab</span><br><span class="hljs-comment"># 根据已有格式添加</span><br><span class="hljs-attr">0</span> <span class="hljs-string">0 * * * node 文件路径</span><br><br><span class="hljs-comment"># 查看是否开机自启</span><br><span class="hljs-attr">chkconfig</span> <span class="hljs-string">--list crond</span><br><span class="hljs-comment"># 自启</span><br><span class="hljs-attr">chkconfig</span> <span class="hljs-string">crond on</span><br></code></pre></td></tr></table></figure>

<p>如果有问题，不知道的可以自己去 google。</p>
<p>以上。</p>
      </section>
      <section class="extra">
        
        <ul class="copyright">
  
  <li><strong>本文作者：</strong>herin</li>
  <li><strong>本文链接：</strong><a href="https://kilicmu.github.io/2020/05/23/BING%E6%AF%8F%E6%97%A5%E5%A3%81%E7%BA%B8%E8%8E%B7%E5%8F%96/index.html">https://kilicmu.github.io/2020/05/23/BING%E6%AF%8F%E6%97%A5%E5%A3%81%E7%BA%B8%E8%8E%B7%E5%8F%96/index.html</a></li>
  <li><strong>版权声明：</strong>本博客所有文章均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"
      rel="external nofollow" target="_blank"> BY-NC-SA </a>许可协议，转载请注明出处！</li>
  
</ul>
        
        
        <section class="donate">
  <div class="qrcode">
    <img   class="lazyload" data-original="/images/others/alipay.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" >
  </div>
  <div class="icon">
    <a href="javascript:;" id="alipay"><i class="iconfont iconalipay"></i></a>
    <a href="javascript:;" id="wechat"><i class="iconfont iconwechat-fill"></i></a>
  </div>
</section>
        
        
  <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/NODEJS/" rel="tag">nodejs</a></li></ul>

        
<nav class="nav">
  
    <a href="/2020/05/29/%E4%BB%8E0%E6%90%AD%E5%BB%BASSM%E7%8E%AF%E5%A2%83/"><i class="iconfont iconleft"></i>从0搭建SSM环境</a>
  
  
    <a href="/2020/05/18/DIFF%E7%AE%97%E6%B3%95%E8%A7%A3%E6%9E%90/">Diff算法解析（暂时坑）<i class="iconfont iconright"></i></a>
  
</nav>

      </section>
      
      <section class="comments">
  
  <div class="btn" id="comments-btn">查看评论</div>
  
  
</section>
      
    </section>
  </div>
</article>
  </div>
</main>
  <footer class="footer">
  <div class="footer-social">
    
    
    
    
    
    <a href="tencent://message/?Menu=yes&uin=102483678 " target="_blank" onMouseOver="this.style.color= '#12B7F5'"
      onMouseOut="this.style.color='#33333D'">
      <i class="iconfont footer-social-item  iconQQ "></i>
    </a>
    
    
    
    
    
    <a href="javascript:; " target="_blank" onMouseOver="this.style.color= '#09BB07'"
      onMouseOut="this.style.color='#33333D'">
      <i class="iconfont footer-social-item  iconwechat-fill "></i>
    </a>
    
    
    
    
    
    <a href="https://www.instagram.com/kilicmu3/ " target="_blank" onMouseOver="this.style.color= '#DA2E76'"
      onMouseOut="this.style.color='#33333D'">
      <i class="iconfont footer-social-item  iconinstagram "></i>
    </a>
    
    
    
    
    
    <a href="https://github.com/kilicmu " target="_blank" onMouseOver="this.style.color= '#24292E'"
      onMouseOut="this.style.color='#33333D'">
      <i class="iconfont footer-social-item  icongithub-fill "></i>
    </a>
    
    
    
    
    
    <a href="kilicmu3389@outlook.com " target="_blank" onMouseOver="this.style.color='#FFBE5B'"
      onMouseOut="this.style.color='#33333D'">
      <i class="iconfont footer-social-item  iconmail"></i>
    </a>
    
  </div>
  <div class="footer-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p></div>
</footer>
  
      <div class="fab fab-plus">
    <i class="iconfont iconplus"></i>
  </div>
  
  <div class="fab fab-daovoice">
    <i class="iconfont iconcomment"></i>
  </div>
  
  <div class="fab fab-up">
    <i class="iconfont iconcaret-up"></i>
  </div>
  
</body>


<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>






<script src="https://cdn.bootcdn.net/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>






<script src="https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.js"></script>






<script src="/js/utils.js"></script>
<script src="/js/modules.js"></script>
<script src="/js/zui.js"></script>
<script src="/js/script.js"></script>





<script>
  (function (i, s, o, g, r, a, m) {
    i["DaoVoiceObject"] = r;
    i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o), m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    a.charset = "utf-8";
    m.parentNode.insertBefore(a, m)
  })(window, document, "script", ('https:' == document.location.protocol ? 'https:' : 'http:') +
    "//widget.daovoice.io/widget/0f81ff2f.js", "daovoice")
  daovoice('init', {
    app_id: "abcdefg"
  }, {
    launcher: {
      disableLauncherIcon: true,
    },
  });
  daovoice('update');
</script>



<script>
  (function () {
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
      bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    } else {
      bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
  })();
</script>


<script>
  var _hmt = _hmt || [];
  (function () {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?4c204d8bc027a0455b5fc642ac334ca8";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>










</html>